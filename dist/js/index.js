(function(){"use strict";function x(d){return new Promise((t,e)=>{const i=new Audio(d);i.onended=()=>t(),i.onerror=()=>e(new Error(`Failed to play audio: ${d}`)),i.play().catch(e)})}function A(d,t){return t?x(d):null}class I{constructor(){this.state="unmuted",this.soundtrack=null,this.audioSrc="./audios/sounds/"}init(t){this.soundtrack=t,this.soundtrack&&(this.soundtrack.volume=.5,this.soundtrack.loop=!0),this.setMuted(!1)}setMuted(t){this.state=t?"muted":"unmuted",this.soundtrack&&(this.soundtrack.volume=t?0:.5),document.querySelectorAll("audio").forEach(e=>{e.volume=t?0:.5})}toggleMute(){this.setMuted(this.state==="unmuted")}getState(){return this.state}play(t){x(`${this.audioSrc}${t}`)}playIfNotMuted(t){A(`${this.audioSrc}${t}`,this.state==="unmuted")}playSoundtrack(){this.soundtrack&&this.state==="unmuted"&&this.soundtrack.play().catch(console.error)}pauseSoundtrack(){this.soundtrack&&(this.soundtrack.pause(),this.soundtrack.currentTime=0)}setAudioSrc(t){this.audioSrc=t}}const b=["JAN","FEV","MAR","AVR","MAI","JUN","JUL","AOU","SEP","OCT","NOV","DEC"];function L(d){const t=d.getDate(),e=b[d.getMonth()],i=d.getFullYear();let s=d.getHours();const n=d.getMinutes(),a=d.getSeconds(),c=s<12;return s=s%12,s=s||12,{month:e,day:E(t),year:i.toString(),hour:E(s),minute:E(n),second:E(a),isAM:c}}function E(d){return d<10?`0${d}`:`${d}`}function l(d){return document.getElementById(d)}function C(d){return document.querySelector(d)}function w(d){return document.querySelectorAll(d)}function g(d){const t=typeof d=="string"?parseInt(d,10):d;return t<10?`0${t}`:`${t}`}class N{constructor(t){this.updateActive=!0,this.intervalId=null,this.presentCircuit=null,this.presentCircuit=t||null}start(){this.updateActive=!0,this.update()}stop(){this.updateActive=!1,this.intervalId!==null&&(clearTimeout(this.intervalId),this.intervalId=null)}update(){if(!this.updateActive){this.intervalId=window.setTimeout(()=>this.update(),1e3);return}const t=L(new Date);this.updatePresentTime(t),this.intervalId=window.setTimeout(()=>this.update(),1e3)}updatePresentTime(t){if(this.presentCircuit)this.presentCircuit.update({month:t.month,day:t.day,year:t.year,hour:t.hour,minute:t.minute,second:""});else{const s=l("present-month"),n=l("present-day"),a=l("present-year"),c=l("present-hour"),h=l("present-minute");if(l("am-present"),l("pm-present"),s){const r=s.querySelector(".lcd-text-main");r&&(r.textContent=t.month)}if(n){const r=n.querySelector(".lcd-text-main");r&&(r.textContent=t.day)}if(a){const r=a.querySelector(".lcd-text-main");r&&(r.textContent=t.year)}if(c){const r=c.querySelector(".lcd-text-main");r&&(r.textContent=t.hour)}if(h){const r=h.querySelector(".lcd-text-main");r&&(r.textContent=t.minute)}}const e=l("am-present"),i=l("pm-present");e&&i&&(t.isAM?(e.classList.add("light-on"),e.classList.remove("light-off"),i.classList.add("light-off"),i.classList.remove("light-on")):(e.classList.add("light-off"),e.classList.remove("light-on"),i.classList.add("light-on"),i.classList.remove("light-off")))}isUpdateActive(){return this.updateActive}setUpdateActive(t){this.updateActive=t}getCurrentDateTime(){return L(new Date)}getMonths(){return b}}class S{constructor(t){this.element=null,this.mainTextElement=null,this.shadowTextElement=null,this.spacerElement=null,this.ribbonElement=null,this.wrapperElement=null,this.options=t}init(){const t=typeof this.options.container=="string"?C(this.options.container):this.options.container;if(!t){console.error("LCDDisplay: Container not found");return}if(this.options.ribbon&&(this.wrapperElement=document.createElement("div"),this.wrapperElement.className="lcd-wrapper",this.ribbonElement=this.createRibbonElement(),this.wrapperElement.appendChild(this.ribbonElement)),this.element=this.createLCDElement(),this.wrapperElement?(this.wrapperElement.appendChild(this.element),t.appendChild(this.wrapperElement)):t.appendChild(this.element),this.options.initialValue)this.update(this.options.initialValue);else{const e="8".repeat(this.options.lcd.digits);this.update(e)}}createRibbonElement(){const t=document.createElement("div");return t.className=`lcd-ribbon lcd-ribbon-${this.options.ribbon.color}`,t.textContent=this.options.ribbon.text,this.options.ribbon.rotate!==0&&(t.style.transform=`rotate(${this.options.ribbon.rotate}deg)`),t}createLCDElement(){const t=document.createElement("div"),e=["lcd","lcd-display",`lcd-${this.options.lcd.digits}digits`,`lcd-${this.options.lcd.color}`,`lcd-${this.options.lcd.segment}seg`];if(this.options.className&&e.push(this.options.className),t.className=e.join(" "),this.options.id&&(t.id=this.options.id),this.spacerElement=document.createElement("span"),this.spacerElement.className="lcd-text-spacer",this.spacerElement.textContent=this.options.initialValue||"8".repeat(this.options.lcd.digits),t.appendChild(this.spacerElement),this.options.lcd.shadow!==!1){if(this.shadowTextElement=document.createElement("span"),this.shadowTextElement.className="lcd-text-shadow",this.options.lcd.segment===16){const i=document.createElement("span");i.className="lcd-shadow-zero",i.textContent="000",this.shadowTextElement.appendChild(i);const s=document.createElement("span");s.className="lcd-shadow-star",s.textContent="***",this.shadowTextElement.appendChild(s)}else{const i="8".repeat(this.options.lcd.digits);this.shadowTextElement.textContent=i}t.appendChild(this.shadowTextElement)}return this.mainTextElement=document.createElement("span"),this.mainTextElement.className="lcd-text-main",t.appendChild(this.mainTextElement),t}update(t){if(!this.mainTextElement)return;const e=this.options.lcd.digits,i=t.slice(0,e).padStart(e,"0");if(this.options.lcd.shadow!==!1){if(!this.shadowTextElement){const s=this.mainTextElement.parentElement;s&&(this.shadowTextElement=document.createElement("span"),this.shadowTextElement.className="lcd-text-shadow",s.insertBefore(this.shadowTextElement,this.mainTextElement))}if(this.shadowTextElement){if(this.options.lcd.segment===16){const s=this.shadowTextElement.querySelector(".lcd-shadow-zero"),n=this.shadowTextElement.querySelector(".lcd-shadow-star");s&&(s.textContent="000"),n&&(n.textContent="***")}else{const s="8".repeat(e);this.shadowTextElement.textContent=s}this.shadowTextElement.style.display="block",this.shadowTextElement.style.visibility="visible",this.shadowTextElement.style.opacity="1"}}this.mainTextElement.textContent=i}setPowerState(t){this.mainTextElement&&(t?(this.mainTextElement.style.opacity="1",this.mainTextElement.style.visibility="visible"):(this.mainTextElement.style.opacity="0",this.mainTextElement.style.visibility="hidden"))}getValue(){var t;return((t=this.mainTextElement)==null?void 0:t.textContent)||""}getElement(){return this.element}destroy(){const t=this.wrapperElement||this.element;t&&t.parentNode&&t.parentNode.removeChild(t),this.element=null,this.mainTextElement=null,this.shadowTextElement=null,this.spacerElement=null,this.ribbonElement=null,this.wrapperElement=null}}class ${constructor(){this.config=null,this.lcds=new Map}loadConfig(t){var s,n,a,c,h,r;const e=window.BTTF_CONFIG;if(!e||!e[t]){console.warn(`BTTF_CONFIG.${t} not found, using defaults`),this.config=this.getDefaultConfig();return}const i=e[t];this.config={month:{lcd:i.month,ribbon:(s=i.ribbon)==null?void 0:s.month},day:{lcd:i.day,ribbon:(n=i.ribbon)==null?void 0:n.day},year:{lcd:i.year,ribbon:(a=i.ribbon)==null?void 0:a.year},hour:{lcd:i.hour,ribbon:(c=i.ribbon)==null?void 0:c.hour},min:{lcd:i.min,ribbon:(h=i.ribbon)==null?void 0:h.min},sec:{lcd:i.sec,ribbon:(r=i.ribbon)==null?void 0:r.sec},ampm:i.ampm??!0,seconds:i.seconds??!1,ribbon:i.ribbon}}getDefaultConfig(){return{month:{lcd:{digits:3,color:"red",shadow:!0,segment:16},ribbon:{text:"MONTH",color:"red",rotate:0}},day:{lcd:{digits:2,color:"red",shadow:!0,segment:7},ribbon:{text:"DAY",color:"red",rotate:0}},year:{lcd:{digits:4,color:"red",shadow:!0,segment:7},ribbon:{text:"YEAR",color:"red",rotate:0}},hour:{lcd:{digits:2,color:"red",shadow:!0,segment:7},ribbon:{text:"HOUR",color:"red",rotate:0}},min:{lcd:{digits:2,color:"red",shadow:!0,segment:7},ribbon:{text:"MIN",color:"red",rotate:0}},sec:{lcd:{digits:2,color:"red",shadow:!0,segment:7},ribbon:{text:"SEC",color:"red",rotate:0}},ampm:!0,seconds:!1}}createLCD(t,e,i,s){if(!this.config)return console.error("TimeCircuitLCDManager: Config not loaded"),null;const n=this.config[t];if(!n)return console.error(`TimeCircuitLCDManager: No config for field ${t}`),null;const a={lcd:{digits:n.lcd.digits,color:n.lcd.color,shadow:n.lcd.shadow!==!1,segment:n.lcd.segment},ribbon:n.ribbon?{text:n.ribbon.text,color:n.ribbon.color,rotate:n.ribbon.rotate}:void 0,container:e,initialValue:i,id:s},c=new S(a);c.init();const h=s||`${t}-${Date.now()}`;return this.lcds.set(h,c),c}updateLCD(t,e,i){const s=i||Array.from(this.lcds.keys()).find(a=>a.includes(t));if(!s){console.warn(`TimeCircuitLCDManager: No LCD found for field ${t}`);return}const n=this.lcds.get(s);n&&n.update(e)}getLCD(t,e){const i=e||Array.from(this.lcds.keys()).find(s=>s.includes(t));return i&&this.lcds.get(i)||null}destroyAll(){this.lcds.forEach(t=>t.destroy()),this.lcds.clear()}getConfig(){return this.config}}class v{constructor(t){this.container=null,this.lcds=new Map,this.amLight=null,this.pmLight=null,this.wrapperElement=null,this.type=t.type,this.options=t,this.manager=new $;const e=this.type==="departed"?"lasttime":this.type;this.manager.loadConfig(e)}parseDate(t){if(t==="today"){const i=new Date;return{month:["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][i.getMonth()],day:String(i.getDate()).padStart(2,"0"),year:String(i.getFullYear())}}const e=t.split("/");if(e.length===3){const i=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],s=parseInt(e[0],10)-1;return{month:i[s]||"JAN",day:e[1].padStart(2,"0"),year:e[2]}}return{month:"JAN",day:"01",year:"1972"}}parseHour(t){if(t==="today"){const i=new Date;let s=i.getHours();const n=s<12,a=s===0?12:s>12?s-12:s;return{hour:String(a).padStart(2,"0"),minute:String(i.getMinutes()).padStart(2,"0"),second:String(i.getSeconds()).padStart(2,"0"),isAM:n}}const e=t.split(":");if(e.length>=2){const i=parseInt(e[0],10),s=i<12,n=i===0?12:i>12?i-12:i;return{hour:String(n).padStart(2,"0"),minute:e[1].padStart(2,"0"),second:e[2]?e[2].padStart(2,"0"):"00",isAM:s}}return{hour:"00",minute:"00",second:"00",isAM:!0}}init(){const t=this.parseDate(this.options.date||"01/01/1972"),e=this.parseHour(this.options.hour||"00:00:00");this.options.month=this.options.month||t.month,this.options.day=this.options.day||t.day,this.options.year=this.options.year||t.year,this.options.hourValue=this.options.hourValue||e.hour,this.options.minute=this.options.minute||e.minute,this.options.second=this.options.second||e.second,this.options.isAM=this.options.isAM??e.isAM,this.createHTML()}createHTML(){const t=this.options.container?typeof this.options.container=="string"?C(this.options.container):this.options.container:C(".overall-container");if(!t)throw new Error(`Container not found for TimeCircuitLCD ${this.type}`);this.container=t;const e=this.type==="destination"?"destination":this.type==="present"?"present":"departed";this.wrapperElement=document.createElement("div"),this.wrapperElement.className=`individual-time-circuit-wrapper-area ${e}`;const i=document.createElement("div");i.className="individual-time-circuit-content";const s=document.createElement("div");s.className="row-of-labels";const n=document.createElement("div");n.className="row-of-numbers-display-area";const a=this.manager.getConfig();if(!a)throw new Error("TimeCircuitLCD: Config not loaded");if(["month","day","year","hour","min"].forEach(o=>{const u=a[o];if(!u)return;if(u.ribbon){const y=document.createElement("div");y.className=`sticker-label ${o}`,y.textContent=u.ribbon.text,u.ribbon.rotate!==0&&(y.style.transform=`rotate(${u.ribbon.rotate}deg)`),y.classList.add(`ribbon-${u.ribbon.color}`),s.appendChild(y)}const m=document.createElement("div");m.className=`lcd-field-wrapper lcd-field-${o}`;const f=document.createElement("div");f.className=`lcd-container-${o}`;const p=this.manager.getConfig();if(p&&p[o]){const y=p[o].lcd,T=new S({lcd:{digits:y.digits,color:y.color,shadow:y.shadow!==!1,segment:y.segment},container:f,initialValue:this.getInitialValue(o),id:`${this.type}-${o}`});T.init(),T&&(this.lcds.set(`${this.type}-${o}`,T),m.appendChild(f))}n.appendChild(m)}),a.ampm){const o=document.createElement("div");o.className="console-display console-am-pm";const u=document.createElement("div");u.className="am-label",u.textContent="AM",this.amLight=document.createElement("div"),this.amLight.className=`light am ${this.options.isAM?"light-on":"light-off"}`,this.amLight.id=`am-${this.type}`;const m=document.createElement("div");m.className="pm-label",m.textContent="PM",this.pmLight=document.createElement("div"),this.pmLight.className=`light pm ${this.options.isAM?"light-off":"light-on"}`,this.pmLight.id=`pm-${this.type}`,o.appendChild(u),o.appendChild(this.amLight),o.appendChild(m),o.appendChild(this.pmLight),n.appendChild(o)}const h=document.createElement("div");if(h.className="console-display colon",h.innerHTML=`
      <div class="colon top"></div>
      <div class="colon bottom"></div>
    `,n.appendChild(h),a.seconds){const o=a.sec;if(o&&o.ribbon){const p=document.createElement("div");p.className="sticker-label sec",p.textContent=o.ribbon.text,o.ribbon.rotate!==0&&(p.style.transform=`rotate(${o.ribbon.rotate}deg)`),p.classList.add(`ribbon-${o.ribbon.color}`),s.appendChild(p)}const u=document.createElement("div");u.className="lcd-field-wrapper lcd-field-sec";const m=document.createElement("div");m.className="lcd-container-sec";const f=this.manager.createLCD("sec",m,this.options.second||"00",`${this.type}-sec`);f&&(this.lcds.set(`${this.type}-sec`,f),u.appendChild(m),n.appendChild(u))}const r=document.createElement("div");if(r.className="footer-label",r.textContent=this.options.text||"",i.appendChild(s),i.appendChild(n),i.appendChild(r),this.wrapperElement.appendChild(i),this.container.id==="time-circuits-wrapper"){const o=this.container.firstElementChild;o?this.container.insertBefore(this.wrapperElement,o):this.container.appendChild(this.wrapperElement)}else this.container.appendChild(this.wrapperElement);setTimeout(()=>{this.syncGridColumns(s,n)},0)}syncGridColumns(t,e){const i=()=>{e.offsetHeight,t.offsetHeight;const n=window.getComputedStyle(e).gridTemplateColumns;n&&n!=="none"&&n.trim()!==""&&n.includes("px")&&t.style.setProperty("grid-template-columns",n,"important")};requestAnimationFrame(()=>{i(),requestAnimationFrame(()=>{i(),setTimeout(()=>{i()},50)})})}getInitialValue(t){switch(t){case"month":return this.options.month||"JAN";case"day":return this.options.day||"01";case"year":return this.options.year||"1972";case"hour":return this.options.hourValue||"00";case"min":return this.options.minute||"00";case"sec":return this.options.second||"00";default:return""}}update(t){if(t.month!==void 0&&t.month!==""){const e=this.lcds.get(`${this.type}-month`);e&&e.update(t.month)}if(t.day!==void 0&&t.day!==""){const e=this.lcds.get(`${this.type}-day`);e&&e.update(t.day)}if(t.year!==void 0&&t.year!==""){const e=this.lcds.get(`${this.type}-year`);e&&e.update(t.year)}if(t.hour!==void 0&&t.hour!==""){const e=this.lcds.get(`${this.type}-hour`);e&&e.update(t.hour)}if(t.minute!==void 0&&t.minute!==""){const e=this.lcds.get(`${this.type}-min`);e&&e.update(t.minute)}if(t.second!==void 0&&t.second!==""){const e=this.lcds.get(`${this.type}-sec`);e&&e.update(t.second)}this.amLight&&this.pmLight&&t.isAM!==void 0&&(this.options.isAM=t.isAM,t.isAM?(this.amLight.classList.add("light-on"),this.amLight.classList.remove("light-off"),this.pmLight.classList.add("light-off"),this.pmLight.classList.remove("light-on")):(this.amLight.classList.add("light-off"),this.amLight.classList.remove("light-on"),this.pmLight.classList.add("light-on"),this.pmLight.classList.remove("light-off")))}getDateTime(){var h,r,o,u,m,f,p;const t=((h=this.lcds.get(`${this.type}-month`))==null?void 0:h.getValue())||"",e=((r=this.lcds.get(`${this.type}-day`))==null?void 0:r.getValue())||"",i=((o=this.lcds.get(`${this.type}-year`))==null?void 0:o.getValue())||"",s=((u=this.lcds.get(`${this.type}-hour`))==null?void 0:u.getValue())||"",n=((m=this.lcds.get(`${this.type}-min`))==null?void 0:m.getValue())||"",a=((f=this.lcds.get(`${this.type}-sec`))==null?void 0:f.getValue())||"",c=((p=this.amLight)==null?void 0:p.classList.contains("light-on"))??!0;return{month:t,day:e,year:i,hour:s,minute:n,second:a,isAM:c}}setPowerState(t){this.lcds.forEach(e=>{e.setPowerState(t)}),this.amLight&&this.pmLight&&(t?this.options.isAM??!0?(this.amLight.classList.add("light-on"),this.amLight.classList.remove("light-off"),this.pmLight.classList.add("light-off"),this.pmLight.classList.remove("light-on")):(this.amLight.classList.add("light-off"),this.amLight.classList.remove("light-on"),this.pmLight.classList.add("light-on"),this.pmLight.classList.remove("light-off")):(this.amLight.classList.remove("light-on"),this.amLight.classList.add("light-off"),this.pmLight.classList.remove("light-on"),this.pmLight.classList.add("light-off")))}destroy(){this.lcds.forEach(t=>t.destroy()),this.lcds.clear(),this.wrapperElement&&this.wrapperElement.parentNode&&this.wrapperElement.parentNode.removeChild(this.wrapperElement),this.wrapperElement=null,this.container=null,this.amLight=null,this.pmLight=null}}class M{constructor(t){this.animation=null,this.min=t.min,this.max=t.max,this.current=t.current,this.element=t.element}init(){this.element&&this.updateDisplay()}updateDisplay(){if(!this.element)return;const t=this.element.querySelector(".lcd-text-main"),e=this.element.querySelector(".lcd-text-shadow"),i=this.element.querySelector(".lcd-text-spacer");t&&(t.textContent=g(this.current)),e&&(e.textContent="88"),i&&(i.textContent="88"),!t&&!e&&(this.element.textContent=g(this.current))}setPowerState(t){if(!this.element)return;const e=this.element.querySelector(".lcd-text-main");e&&(t?(e.style.opacity="1",e.style.visibility="visible"):(e.style.opacity="0",e.style.visibility="hidden"))}setSpeed(t){this.current=Math.max(this.min,Math.min(this.max,t)),this.updateDisplay()}getSpeed(){return this.current}reset(){this.cancelAnimation(),this.current=this.min,this.element&&this.updateDisplay()}cancelAnimation(){this.animation&&(this.animation.cancel(),this.animation=null)}animate(t){this.cancelAnimation(),this.current=this.min;let e=!1;const i=1e3,s=Date.now(),n=()=>{if(e)return;const c=Date.now()-s,h=Math.min(c/i,1),r=1-Math.pow(1-h,3);this.current=Math.floor(0+80*r),this.updateDisplay(),h<1?requestAnimationFrame(n):(this.current=80,a())},a=()=>{if(e)return;let c=80;const h=150;let r=0;const o=()=>{e||(c=80+r,this.current=c,this.updateDisplay(),r++,c<88?setTimeout(o,h):(this.animation=null,t&&setTimeout(()=>{t()},1e3)))};o()};this.animation={cancel:()=>{e=!0}},n()}}class P{constructor(t,e,i,s){this.input="",this.destinationCircuit=null,this.presentCircuit=null,this.departedCircuit=null,this.modal=l("keypad-modal"),this.displayDate=l("keypad-display-date"),this.displayTime=l("keypad-display-time"),this.mode="destination",this.audioManager=t,this.destinationCircuit=e||null,this.presentCircuit=i||null,this.departedCircuit=s||null}init(){const t=C(".date"),e=w(".mode-btn"),i=w(".keypad-key");if(t){const s=t.querySelector("a");s?s.addEventListener("click",n=>{n.preventDefault(),this.open()}):t.addEventListener("click",()=>this.open())}this.modal&&this.modal.addEventListener("click",s=>{s.target===this.modal&&this.close()}),e.forEach(s=>{s.addEventListener("click",()=>{const n=s.getAttribute("data-mode");this.setMode(n)})}),i.forEach(s=>{s.addEventListener("click",()=>{const n=s.getAttribute("data-key");n&&this.handleKey(n)})}),document.addEventListener("keydown",s=>{if(!this.modal||!this.modal.classList.contains("active"))return;let n=null;if(s.key>="0"&&s.key<="9")n=s.key;else if(s.key==="Enter"||s.key==="Return")n="enter";else if(s.key==="Escape"||s.key==="Esc"){this.close();return}else(s.key==="Backspace"||s.key==="Delete")&&(n="backspace");n!==null&&(s.preventDefault(),this.animateKey(n),this.handleKey(n))})}open(){if(this.modal){this.modal.classList.add("active"),this.mode="destination",this.input="",this.updateDisplay(),this.updateModeButtons();const t=C(".date");if(t){const e=t.querySelector("a");t.classList.add("active"),e&&e.classList.add("active-text")}}}close(){if(this.modal){this.modal.classList.remove("active"),this.input="",this.updateDisplay();const t=C(".date");if(t){const e=t.querySelector("a");t.classList.remove("active"),e&&e.classList.remove("active-text")}}}setMode(t){this.mode=t,this.input="",this.updateDisplay(),this.updateModeButtons()}updateModeButtons(){w(".mode-btn").forEach(e=>{if(e.disabled){e.classList.remove("active");return}e.getAttribute("data-mode")===this.mode?e.classList.add("active"):e.classList.remove("active")})}animateKey(t){const e=C(`.keypad-key[data-key="${t}"]`);e&&(e.classList.add("active"),setTimeout(()=>{e.classList.remove("active")},150))}getDialAudio(t){const e=parseInt(t,10);return e===1||e===4||e===7?"bttf-dial-1.mp3":e===2||e===5||e===8||e===0?"bttf-dial-2.mp3":"bttf-dial-3.mp3"}handleKey(t){t==="clear"?(this.input="",this.updateDisplay(),this.audioManager.play("bttf-input-button.mp3")):t==="backspace"?this.input.length>0?(this.input=this.input.substring(0,this.input.length-1),this.updateDisplay(),this.audioManager.playIfNotMuted("bttf-dial-1.mp3")):this.audioManager.play("bttf-input-error.mp3"):t==="enter"?(this.processInput(),this.audioManager.play("bttf-input-button.mp3")):this.input.length<12?(this.input+=t,this.updateDisplay(),this.audioManager.playIfNotMuted(this.getDialAudio(t))):this.audioManager.play("bttf-input-error.mp3")}updateDisplay(){if(!this.displayDate||!this.displayTime)return;if(this.input.length===0){this.displayDate.textContent="MM/DD/YYYY",this.displayTime.textContent="HH:MM";return}const t="MM/DD/YYYY",e="HH:MM",i=t.split(""),s=e.split("");let n=0;for(let a=0;a<i.length&&n<this.input.length&&n<8;a++)i[a]!=="/"&&(i[a]=this.input[n],n++);for(let a=0;a<s.length&&n<this.input.length;a++)s[a]!==":"&&(s[a]=this.input[n],n++);this.displayDate.textContent=i.join(""),this.displayTime.textContent=s.join("")}processInput(){if(this.input.length===0){this.audioManager.play("bttf-input-error.mp3");return}const t=this.input.split("").map(Number),e=l("error");e&&(e.style.display="none"),this.mode==="destination"?this.processDestinationTime(t):this.mode==="present"?this.processPresentTime(t):this.mode==="departed"&&this.processDepartedTime(t),this.input="",this.updateDisplay(),this.close()}processDestinationTime(t){const e=l("error");if(t.length%2||t.length===6){e&&(e.textContent="* INVALID * INPUT",e.style.display="block"),this.audioManager.play("bttf-input-error.mp3");return}if(t.length>=2){const i=t[0]*10+t[1];if(i===0||i>12){e&&(e.textContent="* INVALID * MONTH",e.style.display="block"),this.audioManager.play("bttf-input-error.mp3");return}if(this.destinationCircuit){const s=b[i-1];this.destinationCircuit.update({month:s,day:"",year:"",hour:"",minute:"",second:""})}else{const s=l("destination-month");if(s){const n=s.querySelector(".lcd-text-main");if(n){const a=b[i-1];n.textContent=a}}}}if(t.length>=4){const i=t[2]*10+t[3];if(i===0||i>31){e&&(e.textContent="* INVALID * DAY",e.style.display="block"),this.audioManager.play("bttf-input-error.mp3");return}if(this.destinationCircuit)this.destinationCircuit.update({month:"",day:g(i),year:"",hour:"",minute:"",second:""});else{const s=l("destination-day");if(s){const n=s.querySelector(".lcd-text-main");n&&(n.textContent=g(i))}}}if(t.length>=8){const i=t[4]*1e3+t[5]*100+t[6]*10+t[7];if(this.destinationCircuit)this.destinationCircuit.update({month:"",day:"",year:i.toString(),hour:"",minute:"",second:""});else{const s=l("destination-year");if(s){const n=s.querySelector(".lcd-text-main");n&&(n.textContent=i.toString())}}}if(t.length>=10){const i=t[8]*10+t[9];if(i>23){e&&(e.textContent="* INVALID * HOUR",e.style.display="block"),this.audioManager.play("bttf-input-error.mp3");return}let s=i;const n=l("am-destination"),a=l("pm-destination");if(i>12?(s=i-12,s<10&&(s=parseInt(`0${s}`)),n&&a&&(n.classList.add("light-off"),n.classList.remove("light-on"),a.classList.add("light-on"),a.classList.remove("light-off"))):(s<10&&(s=parseInt(`0${s}`)),n&&a&&(n.classList.add("light-on"),n.classList.remove("light-off"),a.classList.add("light-off"),a.classList.remove("light-on"))),i===12&&n&&a&&(n.classList.remove("light-on"),n.classList.add("light-off"),a.classList.add("light-on"),a.classList.remove("light-off")),this.destinationCircuit)this.destinationCircuit.update({month:"",day:"",year:"",hour:g(s),minute:"",second:""});else{const c=l("destination-hour");if(c){const h=c.querySelector(".lcd-text-main");h&&(h.textContent=g(s))}}}if(t.length>=12){const i=t[10]*10+t[11];if(i>59){e&&(e.textContent="* INVALID * MINUTE",e.style.display="block"),this.audioManager.play("bttf-input-error.mp3");return}if(this.destinationCircuit)this.destinationCircuit.update({month:"",day:"",year:"",hour:"",minute:g(i),second:""});else{const s=l("destination-minute");if(s){const n=s.querySelector(".lcd-text-main");n&&(n.textContent=g(i))}}}this.audioManager.play("bttf-input-success.mp3")}processPresentTime(t){const e=l("error");if(t.length<12){e&&(e.textContent="* INCOMPLETE * INPUT",e.style.display="block"),this.audioManager.play("bttf-input-error.mp3");return}const i=t[0]*10+t[1],s=t[2]*10+t[3],n=t[4]*1e3+t[5]*100+t[6]*10+t[7],a=t[8]*10+t[9],c=t[10]*10+t[11];if(i===0||i>12||s===0||s>31||a>23||c>59){e&&(e.textContent="* INVALID * INPUT",e.style.display="block"),this.audioManager.play("bttf-input-error.mp3");return}if(this.presentCircuit){const u=b[i-1];this.presentCircuit.update({month:u,day:g(s),year:n.toString(),hour:"",minute:"",second:""})}else{const u=l("present-month"),m=l("present-day"),f=l("present-year");if(l("present-hour"),l("present-minute"),l("am-present"),l("pm-present"),u){const p=u.querySelector(".lcd-text-main");if(p){const y=b[i-1];p.textContent=y}}if(m){const p=m.querySelector(".lcd-text-main");p&&(p.textContent=g(s))}if(f){const p=f.querySelector(".lcd-text-main");p&&(p.textContent=n.toString())}}const h=l("am-present"),r=l("pm-present");let o=a;if(a>12?(o=a-12,o<10&&(o=parseInt(`0${o}`)),h&&r&&(h.classList.add("light-off"),h.classList.remove("light-on"),r.classList.add("light-on"),r.classList.remove("light-off"))):(o<10&&(o=parseInt(`0${o}`)),h&&r&&(h.classList.add("light-on"),h.classList.remove("light-off"),r.classList.add("light-off"),r.classList.remove("light-on"))),a===12&&h&&r&&(h.classList.remove("light-on"),h.classList.add("light-off"),r.classList.add("light-on"),r.classList.remove("light-off")),this.presentCircuit)this.presentCircuit.update({month:"",day:"",year:"",hour:g(o),minute:g(c),second:""});else{const u=l("present-hour"),m=l("present-minute");if(u){const f=u.querySelector(".lcd-text-main");f&&(f.textContent=g(o))}if(m){const f=m.querySelector(".lcd-text-main");f&&(f.textContent=g(c))}}this.audioManager.play("bttf-input-success.mp3")}processDepartedTime(t){const e=l("error");if(t.length<12){e&&(e.textContent="* INCOMPLETE * INPUT",e.style.display="block"),this.audioManager.play("bttf-input-error.mp3");return}const i=t[0]*10+t[1],s=t[2]*10+t[3],n=t[4]*1e3+t[5]*100+t[6]*10+t[7],a=t[8]*10+t[9],c=t[10]*10+t[11];if(i===0||i>12||s===0||s>31||a>23||c>59){e&&(e.textContent="* INVALID * INPUT",e.style.display="block"),this.audioManager.play("bttf-input-error.mp3");return}if(this.departedCircuit){const u=b[i-1];this.departedCircuit.update({month:u,day:g(s),year:n.toString(),hour:"",minute:"",second:""})}else{const u=l("departed-month"),m=l("departed-day"),f=l("departed-year");if(u){const p=u.querySelector(".lcd-text-main");if(p){const y=b[i-1];p.textContent=y}}if(m){const p=m.querySelector(".lcd-text-main");p&&(p.textContent=g(s))}if(f){const p=f.querySelector(".lcd-text-main");p&&(p.textContent=n.toString())}}const h=l("am-departed"),r=l("pm-departed");let o=a;if(a>12?(o=a-12,o<10&&(o=parseInt(`0${o}`)),h&&r&&(h.classList.add("light-off"),h.classList.remove("light-on"),r.classList.add("light-on"),r.classList.remove("light-off"))):(o<10&&(o=parseInt(`0${o}`)),h&&r&&(h.classList.add("light-on"),h.classList.remove("light-off"),r.classList.add("light-off"),r.classList.remove("light-on"))),a===12&&h&&r&&(h.classList.remove("light-on"),h.classList.add("light-off"),r.classList.add("light-on"),r.classList.remove("light-off")),this.departedCircuit)this.departedCircuit.update({month:"",day:"",year:"",hour:g(o),minute:g(c),second:""});else{const u=l("departed-hour"),m=l("departed-minute");if(u){const f=u.querySelector(".lcd-text-main");f&&(f.textContent=g(o))}if(m){const f=m.querySelector(".lcd-text-main");f&&(f.textContent=g(c))}}this.audioManager.play("bttf-input-success.mp3")}}class q{constructor(t,e,i,s,n){this.state="off",this.destinationCircuit=null,this.presentCircuit=null,this.departedCircuit=null,this.speedometer=null,this.button=C(".start"),this.icon=l("start-icon"),this.audioManager=t,this.destinationCircuit=e||null,this.presentCircuit=i||null,this.departedCircuit=s||null,this.speedometer=n||null}init(){if(this.button){const t=this.button.querySelector("a");t?t.addEventListener("click",e=>{e.preventDefault(),this.toggle()}):this.button.addEventListener("click",()=>this.toggle())}this.updateIcon()}toggle(){this.state==="off"?this.turnOn():this.turnOff()}turnOn(){this.audioManager.play("bttf-time-circuits-on.mp3"),this.state="on",this.updateIcon(),this.destinationCircuit&&this.destinationCircuit.setPowerState(!0),this.presentCircuit&&this.presentCircuit.setPowerState(!0),this.departedCircuit&&this.departedCircuit.setPowerState(!0),this.speedometer&&this.speedometer.setPowerState(!0)}turnOff(){this.audioManager.play("bttf-time-circuits-off.mp3"),this.state="off",this.updateIcon(),this.audioManager.pauseSoundtrack(),this.destinationCircuit&&this.destinationCircuit.setPowerState(!1),this.departedCircuit&&this.departedCircuit.setPowerState(!1),this.speedometer&&this.speedometer.setPowerState(!1)}updateIcon(){if(this.icon&&(this.icon.style.opacity=this.state==="on"?"1":"0.7"),this.button){const t=this.button.querySelector("a");this.state==="on"?(this.button.classList.add("active"),t&&t.classList.add("active-text")):(this.button.classList.remove("active"),t&&t.classList.remove("active-text"))}}getState(){return this.state}}class H{constructor(t,e,i,s,n){this.resetCount=0,this.button=C(".reset"),this.audioManager=t,this.timeManager=e,this.destinationCircuit=i,this.presentCircuit=s,this.departedCircuit=n}init(){if(this.button){const t=this.button.querySelector("a");t?t.addEventListener("click",e=>{e.preventDefault(),this.handleReset()}):this.button.addEventListener("click",()=>this.handleReset())}}handleReset(){this.audioManager.play("power-up.mp3"),this.resetDates()}resetDates(){if(this.resetCount++,this.resetCount===1){const e=this.presentCircuit.getDateTime();this.departedCircuit.update(e);const s=L(new Date);this.presentCircuit.update({month:s.month,day:s.day,year:s.year,hour:s.hour,minute:s.minute,isAM:s.isAM})}else{this.resetCount=0,this.destinationCircuit.update({month:"NOV",day:"12",year:"1955",hour:"06",minute:"39",isAM:!0}),this.departedCircuit.update({month:"OCT",day:"26",year:"1985",hour:"01",minute:"21",isAM:!0});const i=L(new Date);this.presentCircuit.update({month:i.month,day:i.day,year:i.year,hour:i.hour,minute:i.minute,isAM:i.isAM})}const t=l("error");t&&(t.style.display="none"),this.timeManager.setUpdateActive(!0)}}class B{constructor(t){this.button=l("mute-btn"),this.icon=l("mute-icon"),this.audioManager=t}init(){if(this.button){const t=this.button.querySelector("a");t?t.addEventListener("click",e=>{e.preventDefault(),this.toggle()}):this.button.addEventListener("click",()=>this.toggle())}this.updateIcon()}toggle(){this.audioManager.toggleMute(),this.updateIcon()}updateIcon(){if(this.icon&&(this.audioManager.getState()==="muted"?this.icon.src="assets/icons/volume-mute.svg":this.icon.src="assets/icons/volume.svg"),this.button){const t=this.button.querySelector("a");this.audioManager.getState()==="muted"?(this.button.classList.add("active"),t&&t.classList.add("active-text")):(this.button.classList.remove("active"),t&&t.classList.remove("active-text"))}}}class V{constructor(){this.currentTheme="dark",this.button=l("theme-btn"),this.icon=l("theme-icon"),this.loadTheme()}init(){if(this.button){const t=this.button.querySelector("a");t?t.addEventListener("click",e=>{e.preventDefault(),this.toggle()}):this.button.addEventListener("click",()=>this.toggle())}this.updateTheme()}loadTheme(){const t=localStorage.getItem("theme");t?this.currentTheme=t:window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches?this.currentTheme="light":this.currentTheme="dark"}toggle(){this.currentTheme=this.currentTheme==="dark"?"light":"dark",this.updateTheme(),localStorage.setItem("theme",this.currentTheme)}updateTheme(){const t=document.documentElement;t.classList.remove("dark","light"),t.classList.add(this.currentTheme),this.updateIcon()}updateIcon(){this.icon&&(this.currentTheme==="dark"?(this.icon.src="assets/icons/sun.svg",this.icon.alt="Switch to light theme"):(this.icon.src="assets/icons/moon.svg",this.icon.alt="Switch to dark theme"))}getTheme(){return this.currentTheme}}class O{constructor(t){this.button=C(".travel"),this.keyboardController=t}init(){if(this.button){const t=this.button.querySelector("a");t?t.addEventListener("click",e=>{e.preventDefault(),this.handleTravel()}):this.button.addEventListener("click",()=>this.handleTravel())}}handleTravel(){this.keyboardController.travelInTime()}}class R{constructor(t,e,i,s,n,a,c){this.desTime=[],this.audioManager=t,this.timeManager=e,this.speedometer=i,this.powerButton=s,this.destinationCircuit=n,this.presentCircuit=a,this.departedCircuit=c}init(){window.addEventListener("keydown",t=>this.handleKeyDown(t))}handleKeyDown(t){const e=t.key;if(e>="0"&&e<="9"){this.setDesTime(e),this.audioManager.playIfNotMuted(`bttf-dial-${e==="1"||e==="4"||e==="7"?"1":e==="2"||e==="5"||e==="8"||e==="0"?"2":"3"}.mp3`);return}switch(e){case"Enter":this.inpDesTime(),this.audioManager.play("bttf-input-button.mp3");break;case"x":case"X":this.travelInTime();break;case"Escape":this.audioManager.play("bttf-input-button.mp3");break}}setDesTime(t){if(this.powerButton.getState()==="off")return;this.desTime.length<12?this.desTime.push(t):this.audioManager.play("bttf-input-error.mp3");const e=l("error");e&&(e.style.display="none")}isDestinationTimeComplete(){const t=this.destinationCircuit.getDateTime();return t.month!==""&&t.day!==""&&t.year!==""&&t.hour!==""&&t.minute!==""}inpDesTime(){if(this.powerButton.getState()==="off")return;const t=this.desTime,e=l("error");let i=!1;const s=()=>{if(t[0]==="0"&&t[1]==="0"||parseInt(t[0]+t[1])>12)e&&(e.textContent="* INVALID * MONTH",e.style.display="block"),i=!0;else{const r=parseInt(t[0]+t[1])-1,o=b[r];this.destinationCircuit.update({month:o,day:"",year:"",hour:"",minute:""})}},n=()=>{if(t[2]==="0"&&t[3]==="0"||parseInt(t[2]+t[3])>31)e&&(e.textContent="* INVALID * DAY",e.style.display="block"),i=!0;else{const r=g(parseInt(t[2]+t[3])),o=this.destinationCircuit.getDateTime();this.destinationCircuit.update({month:o.month,day:r,year:"",hour:"",minute:""})}},a=()=>{const r=t[4]+t[5]+t[6]+t[7],o=this.destinationCircuit.getDateTime();this.destinationCircuit.update({month:o.month,day:o.day,year:r,hour:"",minute:""})},c=()=>{const r=parseInt(t[8]+t[9]);if(r>23)e&&(e.textContent="* INVALID * HOUR",e.style.display="block"),i=!0;else{let o=r,u=!0;r>12?(o=r-12,o<10&&(o=parseInt(`0${o}`)),u=!1):(o<10&&(o=parseInt(`0${o}`)),u=r!==12),r===12&&(u=!1);const m=this.destinationCircuit.getDateTime();this.destinationCircuit.update({month:m.month,day:m.day,year:m.year,hour:g(o),minute:"",isAM:u})}},h=()=>{const r=parseInt(t[10]+t[11]);if(r>59)e&&(e.textContent="* INVALID * MINUTE",e.style.display="block"),i=!0;else{const o=this.destinationCircuit.getDateTime();this.destinationCircuit.update({month:o.month,day:o.day,year:o.year,hour:o.hour,minute:g(r),isAM:o.isAM})}};if(t.length%2||t.length===6?(e&&(e.textContent="* INVALID * INPUT",e.style.display="block"),i=!0):t.length===2?s():t.length===4?(s(),n()):t.length===8?(s(),n(),a()):t.length===10?(s(),n(),a(),c()):t.length===12&&(s(),n(),a(),c(),h()),this.desTime.length===0||i){this.audioManager.play("bttf-input-error.mp3"),this.desTime=[];return}if(this.audioManager.play("bttf-input-success.mp3"),t.length===12&&!i){const r=l("keypad-modal");r&&(r.classList.remove("active"),C(".keypad"))}this.desTime=[],this.audioManager.play("bttf-input-button.mp3")}travelInTime(){if(this.powerButton.getState()==="off"){this.audioManager.play("bttf-input-error.mp3");return}if(!this.isDestinationTimeComplete()){this.audioManager.play("bttf-input-error.mp3");return}const t=this.presentCircuit.getDateTime();this.departedCircuit.update(t),this.timeManager.setUpdateActive(!1),this.audioManager.playSoundtrack();const e=this.destinationCircuit.getDateTime();this.speedometer.reset(),this.speedometer.animate(()=>{this.showLightningOverlay(()=>{this.presentCircuit.update(e)})}),this.audioManager.play("bttf-input-success.mp3")}showLightningOverlay(t){const e=l("lightning-overlay");e?(e.classList.add("active"),setTimeout(()=>{e.classList.remove("active"),t&&t()},2e3)):t&&t()}}class D{isGooglePixel9Pro(){const t=window.innerWidth,e=window.innerHeight,i=Math.abs(t-732)<=2,s=Math.abs(e-412)<=2,n=Math.abs(t-412)<=2,a=Math.abs(e-732)<=2;return i&&s||n&&a}updateScaleRatio(){const t=document.getElementById("time-circuits-wrapper");if(!t)return;const e=window.innerWidth,i=window.innerHeight,s=1920,n=1080,a=this.isGooglePixel9Pro();let c;if(a)e>i,c=Math.min(e/s,i/n,1),t.classList.add("pixel9pro");else{const u=e/s,m=i/n;c=Math.min(u,m,1),t.classList.remove("pixel9pro")}t.style.setProperty("--scale-ratio",c.toString());const r=t.offsetHeight*c,o=s*c;if(c===1)t.style.transform=`translate(-50%, -50%) scale(${c})`;else{const u=-(o/2),m=-(r/2);t.style.transform=`translate(${u}px, ${m}px) scale(${c})`,requestAnimationFrame(()=>{const p=t.offsetHeight*c;if(Math.abs(p-r)>1){const y=-(p/2);t.style.transform=`translate(${u}px, ${y}px) scale(${c})`}})}}init(){this.updateScaleRatio();let t;window.addEventListener("resize",()=>{clearTimeout(t),t=window.setTimeout(()=>{this.updateScaleRatio()},100)}),this.audioManager=new I;const e=l("soundtrack");this.audioManager.init(e);try{const i=l("speedometer-value");i?(this.speedometer=new M({min:0,max:88,current:0,element:i}),this.speedometer.init(),this.speedometer.setPowerState(!1)):(console.warn("Speedometer element not found, creating placeholder"),this.speedometer=new M({min:0,max:88,current:0,element:null}))}catch(i){console.error("Error initializing speedometer:",i),this.speedometer=new M({min:0,max:88,current:0,element:null})}this.destinationCircuit=new v({type:"destination",date:"11/12/1955",hour:"06:39:00",text:"DESTINATION TIME",container:"#time-circuits-wrapper"}),this.presentCircuit=new v({type:"present",date:"today",hour:"today",text:"PRESENT TIME",container:"#time-circuits-wrapper"}),this.departedCircuit=new v({type:"departed",date:"10/26/1985",hour:"01:21:00",text:"LAST TIME DEPARTED",container:"#time-circuits-wrapper"});try{this.destinationCircuit.init()}catch(i){console.error("Error initializing destination circuit:",i)}try{this.presentCircuit.init()}catch(i){console.error("Error initializing present circuit:",i)}try{this.departedCircuit.init()}catch(i){console.error("Error initializing departed circuit:",i)}this.timeManager=new N(this.presentCircuit),this.powerButton=new q(this.audioManager,this.destinationCircuit,this.presentCircuit,this.departedCircuit,this.speedometer),this.powerButton.init(),this.destinationCircuit&&this.destinationCircuit.setPowerState(!1),this.departedCircuit&&this.departedCircuit.setPowerState(!1),this.muteButton=new B(this.audioManager),this.muteButton.init(),this.themeButton=new V,this.themeButton.init(),this.keypad=new P(this.audioManager,this.destinationCircuit,this.presentCircuit,this.departedCircuit),this.keypad.init(),this.resetButton=new H(this.audioManager,this.timeManager,this.destinationCircuit,this.presentCircuit,this.departedCircuit),this.resetButton.init(),this.keyboardController=new R(this.audioManager,this.timeManager,this.speedometer,this.powerButton,this.destinationCircuit,this.presentCircuit,this.departedCircuit),this.keyboardController.init(),this.travelButton=new O(this.keyboardController),this.travelButton.init(),this.timeManager.start(),this.syncAdditionalContainerGrid()}syncAdditionalContainerGrid(){const t=()=>{const e=document.querySelector(".individual-time-circuit-content"),i=document.querySelector(".additional-container");if(!e||!i)return;e.offsetHeight,i.offsetHeight;const n=window.getComputedStyle(e).gridTemplateColumns;n&&n!=="none"&&n.trim()!==""&&n.includes("px")&&(i.style.setProperty("grid-template-columns",n,"important"),window.getComputedStyle(i).gridTemplateColumns!==n&&setTimeout(()=>t(),50))};requestAnimationFrame(()=>{t(),requestAnimationFrame(()=>{t(),setTimeout(()=>{t()},100),setTimeout(()=>{t()},300)})})}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{new D().init(),k()}):(new D().init(),k());function k(){const d=document.querySelectorAll(".buttons-container li.reset, .buttons-container li.theme"),t=document.querySelectorAll(".buttons-container li.reset a, .buttons-container li.theme a");d.forEach((e,i)=>{const s=t[i];if(e&&s){const n=()=>{document.querySelectorAll(".buttons-container li.reset, .buttons-container li.theme").forEach(a=>{a.classList.remove("active")}),document.querySelectorAll(".buttons-container li.reset a, .buttons-container li.theme a").forEach(a=>{a.classList.remove("active-text")}),e.classList.add("active"),s.classList.add("active-text")};e.addEventListener("click",a=>{(a.target===e||a.target.tagName!=="A")&&n()})}})}})();
